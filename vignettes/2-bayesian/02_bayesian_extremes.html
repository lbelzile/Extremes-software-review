<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Bayesian univariate inference for extremes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="02_bayesian_extremes_files/libs/clipboard/clipboard.min.js"></script>
<script src="02_bayesian_extremes_files/libs/quarto-html/quarto.js"></script>
<script src="02_bayesian_extremes_files/libs/quarto-html/popper.min.js"></script>
<script src="02_bayesian_extremes_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="02_bayesian_extremes_files/libs/quarto-html/anchor.min.js"></script>
<link href="02_bayesian_extremes_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="02_bayesian_extremes_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="02_bayesian_extremes_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="02_bayesian_extremes_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="02_bayesian_extremes_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#evaluation-of-effectiveness" id="toc-evaluation-of-effectiveness" class="nav-link active" data-scroll-target="#evaluation-of-effectiveness">Evaluation of effectiveness</a></li>
  <li><a href="#methods-for-bayesian-procedures" id="toc-methods-for-bayesian-procedures" class="nav-link" data-scroll-target="#methods-for-bayesian-procedures">Methods for Bayesian procedures</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Bayesian univariate inference for extremes</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>Creating a benchmark for Bayesian univariate analysis of extremes is complicated because approximate posterior samples returned by Markov chain Monte Carlo are autocorrelated so we cannot rely only on speed of execution or correctness. The effective sample size, which measures the equivalent number of independent draws from the posterior, is a better unit than the number of draws returned. We also factor in the amount of time it takes for the algorithm to proceed, but note that higher initialization costs may make such comparisons unfair if the cost of setup is larger than that of sampling. The different packages use different sampling algorithms: those that are implemented in low-level programming languages like <em>C</em> are inherently faster. Most packages that uses random walk Metropolis–Hastings steps discard initial draws during the so-called burn-in period (sometimes to tune proposal standard deviations, mostly to let the chain reach the posterior distribution and reduce impact of starting values). Other considerations include flexibility of methods, the choice of likelihood or the possibility to include covariates.</p>
<ul>
<li>In the <code>texmex</code> package, users can run multiple chains with burn-in and thinning, but iterations are preserved (which results in a heavier memory footprint). The choice of prior is restricted and, contrary to most packages, proposals are independent draws from the maximum a posteriori distribution. This allows for good mixing, at the expense of a preliminary optimization (and tentatively terrible results should the latter fail to converge to the maximum a posteriori).</li>
<li>The <code>evdbayes</code> package has a comprehensive documentation, but some of its features are unconventional: the generalized Pareto model includes a location parameter that is modeled along as the threshold, but this is typically fixed. This leads to many proposals for the random walk Metropolis–Hastings ratio that lead to negative infinite, so we discard this altogether from the comparison. It can lead to adaption of the proposal.</li>
<li>While very flexible, <code>extRemes</code> is noticeably slower than other packages and particularly inefficient with the default options (not setting <code>proposalParams</code> lead to effective sample size that are insufficient for any analysis to be reliable in our examples). It can be somewhat customized (and includes more flexible prior specification), but there is limited documentation on how to complete this in the package itself (but see the accompanying <a href="https://www.jstatsoft.org/article/view/v072i08">Journal of Statistical Software paper</a>). The current options for evaluating the marginal likelihood in <code>BayesFactor</code> are unreliable and shouldn’t be used (e.g., <a href="https://radfordneal.wordpress.com/2008/08/17/the-harmonic-mean-of-the-likelihood-worst-monte-carlo-method-ever/">Neal, 2018</a>).</li>
<li>The <code>ExtremalDep</code> package also allows for estimation of the generalized extreme value distribution with potential covariates for the location parameter and censoring below a marginal threshold, using a random walk Metropolis-Hastings algorithm. However, the user needs to provide starting values and default values for the variances of the multivariate normal proposals, <code>sig0</code>, and the code returns an error if there is no censoring and covariates are provided. The output is less user-friendly than other packages, as there are no methods associated with the returned list.</li>
<li><code>revdbayes</code> provides independent draws from the posterior at a fraction of the costs of the other packages. Unless one has to include covariates in the parameters, it is the recommended approach.</li>
</ul>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell" data-warnings="false">

</div>
<section id="evaluation-of-effectiveness" class="level3">
<h3 class="anchored" data-anchor-id="evaluation-of-effectiveness">Evaluation of effectiveness</h3>
<p>We look at computation time and effectiveness of algorithms as measured by the effective sample size, computed using the <code>coda</code> method (based on autocorrelation of the chains). Alternative better methods exist based on running multiple chains, but we forego these.</p>
<p>The <code>revdbayes</code> implementation is exact and fastest, thus should be privileged in any problem not involving covariates. <strong>Stan</strong> simulates posterior samples using an Hamiltonian Monte Carlo algorithm. The latter is much more efficient Metropolis-Hasting random walk proposals since it uses information about the geometry of the posterior distribution: the programming language requires bespoke definitions of the extreme value models and some care is necessary for shapes close to zero for the GEV.</p>
<p>Of all the remaining packages, <code>texmex</code> gives the best performance because it uses proposals informed by the maximum a posteriori. This wouldn’t necessarily work with a multimodal objective function, but seems to do a good job in the simple scenarios we considered (and which are supported by the package). While we cannot know if we have converged to the target posterior distribution, the chains appear stationary.</p>
<p>The algorithm for <code>MCMC4Extremes</code> is fast considering the number of observations it samples, but the implementation is crude and inefficient, including a burn-in period of 50K simulations, contrary to what the documentation states. The function is also not customizable.</p>
<p>The performance of <code>extRemes</code> is more dependent on tuning parameters than other implementations. Initial trials with the default parameter revealed problems: while the model starts at the MLE (so close to the stationary distribution), the default standard deviation of the normal random walk proposals are particulary ill-suited to the Venice sea level example. Trace plots (not shown) revealed lack of stationarity with default tuning parameters. With adapted proposals (and vague priors), the output seems satisfactory, but the effective sample size is subpar with other methods.</p>
<p>The <code>evdbayes</code> package includes a generalized Pareto model, but the latter also has a location parameter so is not directly comparable with other outputs.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-benchmark" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="02_bayesian_extremes_files/figure-html/fig-benchmark-1.png" class="img-fluid figure-img" style="width:90.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Swarm plot of speed (including preliminary optimization if necessary) of different numerical routines for a generalized extreme value model with linear trend in location fitted to the Venice sea level data (left) and the generalized Pareto distribution fitted to the Eskdalemuir rainfall data (right).</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell">

</div>
<div id="tbl-ess" class="cell tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Table&nbsp;1: Effective sample size over number of iterations (percentage).</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-ess-1" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-ess" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped">
<caption>(a) nonstationary generalized extreme value model</caption>
<thead>
<tr class="header">
<th style="text-align: left;">package</th>
<th style="text-align: right;">loc</th>
<th style="text-align: right;">loc (trend)</th>
<th style="text-align: right;">scale</th>
<th style="text-align: right;">shape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">texmex</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">7.0</td>
<td style="text-align: right;">7.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">extRemes</td>
<td style="text-align: right;">6.1</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">6.9</td>
<td style="text-align: right;">4.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">evdbayes</td>
<td style="text-align: right;">10.1</td>
<td style="text-align: right;">4.6</td>
<td style="text-align: right;">9.5</td>
<td style="text-align: right;">13.2</td>
</tr>
<tr class="even">
<td style="text-align: left;">STAN</td>
<td style="text-align: right;">86.8</td>
<td style="text-align: right;">98.0</td>
<td style="text-align: right;">69.9</td>
<td style="text-align: right;">59.3</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-ess-2" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-ess" style="flex-basis: 100.0%;justify-content: center;">
<table class="table table-sm table-striped">
<caption>(b) generalized Pareto model</caption>
<thead>
<tr class="header">
<th style="text-align: left;">package</th>
<th style="text-align: right;">scale</th>
<th style="text-align: right;">shape</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">texmex</td>
<td style="text-align: right;">12.4</td>
<td style="text-align: right;">10.3</td>
</tr>
<tr class="even">
<td style="text-align: left;">extRemes</td>
<td style="text-align: right;">4.5</td>
<td style="text-align: right;">4.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">STAN</td>
<td style="text-align: right;">40.9</td>
<td style="text-align: right;">42.1</td>
</tr>
<tr class="even">
<td style="text-align: left;">MCMC4extremes</td>
<td style="text-align: right;">6.6</td>
<td style="text-align: right;">7.1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="methods-for-bayesian-procedures" class="level3">
<h3 class="anchored" data-anchor-id="methods-for-bayesian-procedures">Methods for Bayesian procedures</h3>
<p>The following code exposes the <code>S3</code> methods for the different extreme value implementations. Note that <code>evdbayes</code> returns a matrix rather than a list, with attributes encoding the acceptance rate of the algorithm.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Class 'evmSim' from the 'texmex' package"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] AIC              coef             endPoint         ggplot          
 [5] linearPredictors plot             predict          print           
 [9] residuals        rl               simulate         summary         
[13] thinAndBurn     
see '?methods' for accessing help and source code</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Class 'evpost' from the 'revdbayes' package"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] plot     pp_check predict  print    summary 
see '?methods' for accessing help and source code</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Classes 'gevp' and 'gpdp' from the 'MCMC4Extremes' package"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] plot    summary
see '?methods' for accessing help and source code</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] plot    summary
see '?methods' for accessing help and source code</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Class 'fecd'from the 'extRemes' package"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] blockmaxxer  ci           datagrabber  distill      findpars    
 [6] pextRemes    plot         postmode     print        return.level
[11] rextRemes    setup.design strip        summary      trans       
see '?methods' for accessing help and source code</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "not all methods for this class are relevant."</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>